<a id="mulu">目录</a>
<a href="#mulu" class="back">回到目录</a>
<style>
    .back{width:40px;height:40px;display:inline-block;line-height:20px;font-size:20px;background-color:lightyellow;position: fixed;bottom:50px;right:50px;z-index:999;border:2px solid pink;opacity:0.3;transition:all 0.3s;color:green;}
    .back:hover{color:red;opacity:1}
    img{vertical-align:bottom;}
</style>

<!-- @import "[TOC]" {cmd="toc" depthFrom=3 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [基础效果](#基础效果)
    - [初始化列表](#初始化列表)
    - [添加](#添加)
    - [勾选](#勾选)
    - [删除](#删除)

<!-- /code_chunk_output -->

<!-- 打开侧边预览：f1->Markdown Preview Enhanced: open...
只有打开侧边预览时保存才自动更新目录 -->

写在前面：此笔记来自b站课程[尚硅谷Vue2.0+Vue3.0全套教程](https://www.bilibili.com/video/BV1Zy4y1K7SH) / [资料下载](https://www.aliyundrive.com/s/B8sDe5u56BU/folder/61138e6e8582eecbe4c84546a1b2d58363d20bc0)

组件化编码流程：
- 实现静态组件：抽取组件，实现静态页面效果
- 展示动态数据：数据的类型、名称、保存在哪个组件
- 交互：从绑定事件监听开始

### 基础效果
![展示1](./md-image/展示1.png){:width=200 height=200}
- 输入任务名称，按回车后添加到下面
- 每个列表项都有删除按钮，点击后删除
- 每个列表项都有复选框（代表是否完成），底部有全选按钮
- 右下角清除选中的任务

组件划分：
- 最上面的输入框`TodoHeader`
- 中间的事项列表`TodoList`
  - 每个列表项`TodoItem`
- 下面的两个按钮`TodoFooter`

创建vue项目：`vue create todo-list`
- 之后在components中创建4个组件，将`资料\04_静态页面\1_todos_page`中的HTML和CSS拆分到每个组件中
##### 初始化列表
数据结构：一个数组，每个元素是一个对象，对应一个列表项，包括事项id、名称、是否完成
- 保存在`App`中，然后把这个数组通过props传个三个组件。如果保存`TodoList`中，后面要通过添加按钮/删除按钮修改该数据，就涉及同级组件间传递数据

```js
/* App.vue */
data() {
    return {
        todos:[
            {id:'001', title:"吃饭", done:true},
            {id:'002', title:"睡觉", done:false},
            {id:'003', title:"写作业", done:false},
        ]
    }
}
```
使用vfor遍历，并把数据传入`TodoItem`中
```html
<!-- TodoList.vue -->
<TodoItem v-for="todo in todos" :key="todo.id" :todo="todo"/>
<script>
    import TodoItem from './TodoItem.vue'
    export default {
        name:"TodoList",
        components:{TodoItem},
        props:['todos']
        
    }
</script>
<!-- TodoItem.vue -->
<label>
    <input type="checkbox" :checked="todo.done"/>
    <!-- 如果完成，就默认勾选 -->
    <span>{{todo.title}}</span>
</label>
<script>
    export default {
        name:"TodoItem",
        props:['todo'],
    }
</script>
```
##### 添加
给input加一个键盘事件
关键问题：如何确定新事项的id
- 使用`nanoid`包：`npm i nanoid`
- 可生成一个唯一的id

子组件`TodoHeader`修改父组件`App`中的数据：
- 父组件中定义一个修改数据的函数，然后将该函数通过props传给子组件，子组件调用该函数即可修改。简单来说，就是“数据在哪，操作数据的方法就写在哪”

```html
<!-- App.vue -->
<TodoHeader :addTodo="addTodo"/>
<script>
methods: {
    addTodo(todo){
        this.todos.unshift(todo); //添加到数组的最前面，让新事项展示在列表最上方
    }
},
</script>
<!-- TodoHeader.vue -->
<script>
    methods: {
        add(e){
            const input = e.target.value.trim();
            e.target.value = ''; //清空输入框
            if(!input) return alert("输入不能为空"); //不能添加空字符串
            const todo = { //要添加的todo
                id:nanoid(),
                title:input,
                done:false
            };
            this.addTodo(todo); //添加todo
        },
    }
</script>
```
注意：函数名`addTodo`不能与方法名`add`，否则传递时会覆盖
##### 勾选
**第一种方法：与上面的方法相同，都是通过传函数**
- 获取点击的li对应的id：item组件中`todo.id`就是对应的id

```html
<!-- App.vue -->
<TodoList :todos="todos" :checkTodo="checkTodo"/>
<script>
    methods: {
        checkTodo(id){ //勾选/取消勾选
            this.todos.forEach(todo=>{
                if(todo.id===id) todo.done = !todo.done;
            });
        }
    },
</script>
<!-- TodoList.vue -->
<TodoItem 
    v-for="todo in todos" 
    :key="todo.id" 
    :todo="todo" 
    :checkTodo="checkTodo"
/>
<!-- 添加props略，下同 -->
<!-- TodoItem.vue -->
<input type="checkbox" :checked="todo.done" @change="HandleCheck(todo.id)"/>
<script>
    methods: {
        HandleCheck(id){
            this.checkTodo(id)
        }
    },
</script>
```
**第二种方法：直接用vmodel绑定checked属性**
```html
<!-- TodoItem.vue -->
<input type="checkbox" v-model:checked="todo.done"/>
```
- 因为是双向数据绑定，能同时实现初始化和更改
- 但不建议这么写，因为todo是props从上级传来的，而props不建议修改
- 为什么控制台没警告：对于js的基本数据类型，修改它的值就是修改；而对于对象，必须修改地址（改为一个新对象）才算是修改，改属性值不能被监测到
##### 删除
实现思路同上
```html
<!-- App.vue -->
<TodoList :todos="todos" :checkTodo="checkTodo" :deleteTodo="deleteTodo"/>
<script>
    methods: {
        deleteTodo(id){
            this.todos = this.todos.filter(todo=>{
                return todo.id !== id;
            });
        }
    },
</script>
<!-- TodoList.vue -->
<TodoItem 
    v-for="todo in todos" 
    :key="todo.id" 
    :todo="todo" 
    :checkTodo="checkTodo"
    :deleteTodo="deleteTodo"
/>
<!-- 添加props略，下同 -->
<!-- TodoItem.vue -->
<button class="btn btn-danger" @click="HandleDelete(todo.id)">删除</button>
<script>
    methods: {
        HandleDelete(id){
            if(confirm("确定删除吗？")) this.deleteTodo(id);
        }
    },
</script>
```
